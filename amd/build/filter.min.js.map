{"version":3,"file":"filter.min.js","sources":["../src/filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/*\n * @package    local_wb_news\n * @copyright  Wunderbyte GmbH\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nconst SELECTORS = {\n    ALLINSTANCES: '[data-id=\"wb-categoryfilter-instance\"]',\n    ITEMCONTAINER: '[data-id=\"wb-categoryfilter-items\"]',\n};\n\nfunction buildDropdown(categories, onSelect) {\n    const wrapper = document.createElement('div');\n    wrapper.className = 'dropdown mb-3';\n    wrapper.innerHTML = `\n<button class=\"btn btn-outline-secondary dropdown-toggle\" type=\"button\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\" data-id=\"wb-categoryfilter-button\">Kategorie: Alle</button>\n<ul class=\"dropdown-menu\" data-id=\"wb-categoryfilter-menu\"></ul>`;\n    const ul = wrapper.querySelector('[data-id=\"wb-categoryfilter-menu\"]');\n\n    const addItem = (label, value) => {\n        const li = document.createElement('li');\n        const a = document.createElement('a');\n        a.className = 'dropdown-item';\n        a.href = '#';\n        a.setAttribute('data-value', value);\n        a.textContent = label;\n        li.appendChild(a);\n        ul.appendChild(li);\n    };\n\n    addItem('Alle', '__all__');\n    categories.forEach(c => addItem(c, c));\n\n    wrapper.addEventListener('click', e => {\n        const a = e.target.closest('a.dropdown-item');\n        if (!a) return;\n        e.preventDefault();\n        const value = a.getAttribute('data-value');\n        const btn = wrapper.querySelector('[data-id=\"wb-categoryfilter-button\"]');\n        btn.textContent = 'Kategorie: ' + (value === '__all__' ? 'Alle' : a.textContent);\n        onSelect(value);\n    });\n\n    return wrapper;\n}\n\nfunction normalizeList(val) {\n    return (val || '')\n        .split(/[,;|]/)\n        .map(s => s.trim())\n        .filter(Boolean);\n}\n\nfunction setupInstance(container) {\n    const listRoot = container.querySelector(SELECTORS.ITEMCONTAINER) || container;\n    const items = Array.from(listRoot.querySelectorAll('[data-category]'));\n\n    const categories = Array.from(new Set(\n        items.flatMap(el => normalizeList(el.getAttribute('data-category')))\n    )).sort((a, b) => a.localeCompare(b));\n\n    const dropdown = buildDropdown(categories, value => {\n        items.forEach(el => {\n            if (value === '__all__') {\n                el.classList.remove('d-none');\n                return;\n            }\n            const cats = normalizeList(el.getAttribute('data-category'));\n            const match = cats.includes(value);\n            el.classList.toggle('d-none', !match);\n        });\n    });\n\n    container.insertBefore(dropdown, listRoot);\n}\n\nexport const init = () => {\n    const containers = document.querySelectorAll(SELECTORS.ALLINSTANCES);\n    containers.forEach(container => {\n        if (container.dataset.initialized) return;\n        container.dataset.initialized = 'true';\n        setupInstance(container);\n        container.addEventListener('click', e => {\n            const t = e.target;\n            if (t && t.dataset && t.dataset.action) {\n                // reserviert für spätere Aktionen; aktuell nicht benötigt\n            }\n        });\n    });\n};\n"],"names":["SELECTORS","normalizeList","val","split","map","s","trim","filter","Boolean","setupInstance","container","listRoot","querySelector","items","Array","from","querySelectorAll","dropdown","categories","onSelect","wrapper","document","createElement","className","innerHTML","ul","addItem","label","value","li","a","href","setAttribute","textContent","appendChild","forEach","c","addEventListener","e","target","closest","preventDefault","getAttribute","buildDropdown","Set","flatMap","el","sort","b","localeCompare","classList","remove","match","includes","toggle","insertBefore","dataset","initialized","t","action"],"mappings":";;;;;;MAoBMA,uBACY,yCADZA,wBAEa,+CAsCVC,cAAcC,YACXA,KAAO,IACVC,MAAM,SACNC,KAAIC,GAAKA,EAAEC,SACXC,OAAOC,kBAGPC,cAAcC,iBACbC,SAAWD,UAAUE,cAAcZ,0BAA4BU,UAC/DG,MAAQC,MAAMC,KAAKJ,SAASK,iBAAiB,oBAM7CC,kBAlDaC,WAAYC,gBACzBC,QAAUC,SAASC,cAAc,OACvCF,QAAQG,UAAY,gBACpBH,QAAQI,UAAa,gQAGfC,GAAKL,QAAQR,cAAc,sCAE3Bc,QAAU,CAACC,MAAOC,eACdC,GAAKR,SAASC,cAAc,MAC5BQ,EAAIT,SAASC,cAAc,KACjCQ,EAAEP,UAAY,gBACdO,EAAEC,KAAO,IACTD,EAAEE,aAAa,aAAcJ,OAC7BE,EAAEG,YAAcN,MAChBE,GAAGK,YAAYJ,GACfL,GAAGS,YAAYL,YAGnBH,QAAQ,OAAQ,WAChBR,WAAWiB,SAAQC,GAAKV,QAAQU,EAAGA,KAEnChB,QAAQiB,iBAAiB,SAASC,UACxBR,EAAIQ,EAAEC,OAAOC,QAAQ,uBACtBV,EAAG,OACRQ,EAAEG,uBACIb,MAAQE,EAAEY,aAAa,cACjBtB,QAAQR,cAAc,wCAC9BqB,YAAc,eAA2B,YAAVL,MAAsB,OAASE,EAAEG,aACpEd,SAASS,UAGNR,QAkBUuB,CAJE7B,MAAMC,KAAK,IAAI6B,IAC9B/B,MAAMgC,SAAQC,IAAM7C,cAAc6C,GAAGJ,aAAa,sBACnDK,MAAK,CAACjB,EAAGkB,IAAMlB,EAAEmB,cAAcD,MAESpB,QACvCf,MAAMsB,SAAQW,QACI,YAAVlB,kBACAkB,GAAGI,UAAUC,OAAO,gBAIlBC,MADOnD,cAAc6C,GAAGJ,aAAa,kBACxBW,SAASzB,OAC5BkB,GAAGI,UAAUI,OAAO,UAAWF,aAIvC1C,UAAU6C,aAAatC,SAAUN,wBAGjB,KACGU,SAASL,iBAAiBhB,wBAClCmC,SAAQzB,YACXA,UAAU8C,QAAQC,cACtB/C,UAAU8C,QAAQC,YAAc,OAChChD,cAAcC,WACdA,UAAU2B,iBAAiB,SAASC,UAC1BoB,EAAIpB,EAAEC,OACRmB,GAAKA,EAAEF,SAAWE,EAAEF,QAAQG"}
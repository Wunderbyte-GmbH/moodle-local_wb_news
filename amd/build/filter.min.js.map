{"version":3,"file":"filter.min.js","sources":["../src/filter.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n/*\n * @package    local_wb_news\n * @copyright  Wunderbyte GmbH\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nconst SELECTORS = {\n    ROOT: '[data-id=\"wb-categoryfilter-instance\"]',\n    ROWS: '[data-id=\"wb-categoryfilter-items\"]',\n    ITEM: '[data-category]',\n    SLIDE: '.carousel-item'\n};\n\nfunction normalizeList(val) {\n    return (val || '')\n        .split(/[,;|]/)\n        .map(s => s.trim())\n        .filter(Boolean);\n}\n\nfunction buildDropdown(categories, onSelect) {\n    const wrap = document.createElement('div');\n    wrap.className = 'dropdown mb-3';\n    wrap.innerHTML = `\n<button class=\"btn btn-outline-secondary dropdown-toggle\" type=\"button\" data-toggle=\"dropdown\" aria-expanded=\"false\" data-id=\"wb-categoryfilter-button\">Kategorie: Alle</button>\n<ul class=\"dropdown-menu\" data-id=\"wb-categoryfilter-menu\"></ul>`;\n    const ul = wrap.querySelector('[data-id=\"wb-categoryfilter-menu\"]');\n\n    const add = (label, value) => {\n        const li = document.createElement('li');\n        const a = document.createElement('a');\n        a.className = 'dropdown-item';\n        a.href = '#';\n        a.dataset.value = value;\n        a.textContent = label;\n        li.appendChild(a);\n        ul.appendChild(li);\n    };\n\n    add('Alle', '__all__');\n    categories.forEach(c => add(c, c));\n\n    wrap.addEventListener('click', e => {\n        const a = e.target.closest('a.dropdown-item');\n        if (!a) return;\n        e.preventDefault();\n        const value = a.dataset.value;\n        const btn = wrap.querySelector('[data-id=\"wb-categoryfilter-button\"]');\n        btn.textContent = 'Kategorie: ' + (value === '__all__' ? 'Alle' : a.textContent);\n        onSelect(value);\n    });\n\n    return wrap;\n}\n\nfunction updateSlidesVisibility(root) {\n    const slides = Array.from(root.querySelectorAll(SELECTORS.SLIDE));\n    let firstVisible = null;\n\n    slides.forEach(slide => {\n        const row = slide.querySelector(SELECTORS.ROWS);\n        const visibleCount = row ? row.querySelectorAll(`${SELECTORS.ITEM}:not(.d-none)`).length : 0;\n        const isActive = slide.classList.contains('active');\n        const shouldHide = visibleCount === 0;\n        slide.classList.toggle('d-none', shouldHide);\n        if (shouldHide && isActive) {\n            slide.classList.remove('active');\n        }\n        if (!shouldHide && !firstVisible) {\n            firstVisible = slide;\n        }\n    });\n\n    const anyActive = slides.some(s => s.classList.contains('active') && !s.classList.contains('d-none'));\n    if (!anyActive && firstVisible) {\n        firstVisible.classList.add('active');\n    }\n}\n\nfunction setupOneCarousel(root) {\n    const rows = Array.from(root.querySelectorAll(SELECTORS.ROWS));\n    const items = rows.flatMap(r => Array.from(r.querySelectorAll(SELECTORS.ITEM)));\n\n    const categories = Array.from(new Set(\n        items.flatMap(el => normalizeList(el.getAttribute('data-category')))\n    )).sort((a, b) => a.localeCompare(b));\n\n    const dropdown = buildDropdown(categories, value => {\n        items.forEach(el => {\n            if (value === '__all__') {\n                el.classList.remove('d-none');\n                return;\n            }\n            const cats = normalizeList(el.getAttribute('data-category'));\n            el.classList.toggle('d-none', !cats.includes(value));\n        });\n        updateSlidesVisibility(root);\n    });\n\n    root.insertBefore(dropdown, root.firstElementChild || null);\n    updateSlidesVisibility(root);\n}\n\nexport const init = () => {\n    const roots = Array.from(document.querySelectorAll(SELECTORS.ROOT));\n    roots.forEach(root => {\n        if (root.dataset.initialized) return;\n        root.dataset.initialized = 'true';\n        setupOneCarousel(root);\n    });\n};\n\n"],"names":["SELECTORS","normalizeList","val","split","map","s","trim","filter","Boolean","updateSlidesVisibility","root","slides","Array","from","querySelectorAll","firstVisible","forEach","slide","row","querySelector","visibleCount","length","isActive","classList","contains","shouldHide","toggle","remove","some","add","setupOneCarousel","items","flatMap","r","dropdown","categories","onSelect","wrap","document","createElement","className","innerHTML","ul","label","value","li","a","href","dataset","textContent","appendChild","c","addEventListener","e","target","closest","preventDefault","buildDropdown","Set","el","getAttribute","sort","b","localeCompare","cats","includes","insertBefore","firstElementChild","initialized"],"mappings":";;;;;;MAmBMA,eACI,yCADJA,eAEI,sCAFJA,eAGI,kBAHJA,gBAIK,0BAGFC,cAAcC,YACXA,KAAO,IACVC,MAAM,SACNC,KAAIC,GAAKA,EAAEC,SACXC,OAAOC,kBAsCPC,uBAAuBC,YACtBC,OAASC,MAAMC,KAAKH,KAAKI,iBAAiBd,sBAC5Ce,aAAe,KAEnBJ,OAAOK,SAAQC,cACLC,IAAMD,MAAME,cAAcnB,gBAC1BoB,aAAeF,IAAMA,IAAIJ,iBAAkB,GAAEd,+BAA+BqB,OAAS,EACrFC,SAAWL,MAAMM,UAAUC,SAAS,UACpCC,WAA8B,IAAjBL,aACnBH,MAAMM,UAAUG,OAAO,SAAUD,YAC7BA,YAAcH,UACdL,MAAMM,UAAUI,OAAO,UAEtBF,YAAeV,eAChBA,aAAeE,WAILN,OAAOiB,MAAKvB,GAAKA,EAAEkB,UAAUC,SAAS,YAAcnB,EAAEkB,UAAUC,SAAS,aACzET,cACdA,aAAaQ,UAAUM,IAAI,mBAI1BC,iBAAiBpB,YAEhBqB,MADOnB,MAAMC,KAAKH,KAAKI,iBAAiBd,iBAC3BgC,SAAQC,GAAKrB,MAAMC,KAAKoB,EAAEnB,iBAAiBd,mBAMxDkC,kBAnEaC,WAAYC,gBACzBC,KAAOC,SAASC,cAAc,OACpCF,KAAKG,UAAY,gBACjBH,KAAKI,UAAa,6PAGZC,GAAKL,KAAKlB,cAAc,sCAExBU,IAAM,CAACc,MAAOC,eACVC,GAAKP,SAASC,cAAc,MAC5BO,EAAIR,SAASC,cAAc,KACjCO,EAAEN,UAAY,gBACdM,EAAEC,KAAO,IACTD,EAAEE,QAAQJ,MAAQA,MAClBE,EAAEG,YAAcN,MAChBE,GAAGK,YAAYJ,GACfJ,GAAGQ,YAAYL,YAGnBhB,IAAI,OAAQ,WACZM,WAAWnB,SAAQmC,GAAKtB,IAAIsB,EAAGA,KAE/Bd,KAAKe,iBAAiB,SAASC,UACrBP,EAAIO,EAAEC,OAAOC,QAAQ,uBACtBT,EAAG,OACRO,EAAEG,uBACIZ,MAAQE,EAAEE,QAAQJ,MACZP,KAAKlB,cAAc,wCAC3B8B,YAAc,eAA2B,YAAVL,MAAsB,OAASE,EAAEG,aACpEb,SAASQ,UAGNP,KAmCUoB,CAJE7C,MAAMC,KAAK,IAAI6C,IAC9B3B,MAAMC,SAAQ2B,IAAM1D,cAAc0D,GAAGC,aAAa,sBACnDC,MAAK,CAACf,EAAGgB,IAAMhB,EAAEiB,cAAcD,MAESlB,QACvCb,MAAMf,SAAQ2C,QACI,YAAVf,kBACAe,GAAGpC,UAAUI,OAAO,gBAGlBqC,KAAO/D,cAAc0D,GAAGC,aAAa,kBAC3CD,GAAGpC,UAAUG,OAAO,UAAWsC,KAAKC,SAASrB,WAEjDnC,uBAAuBC,SAG3BA,KAAKwD,aAAahC,SAAUxB,KAAKyD,mBAAqB,MACtD1D,uBAAuBC,oBAGP,KACFE,MAAMC,KAAKyB,SAASxB,iBAAiBd,iBAC7CgB,SAAQN,OACNA,KAAKsC,QAAQoB,cACjB1D,KAAKsC,QAAQoB,YAAc,OAC3BtC,iBAAiBpB"}